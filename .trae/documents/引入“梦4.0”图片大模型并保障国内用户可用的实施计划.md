## 报错说明
- 这是 IDE 的 MCP 工具与当前模型/服务的参数协议不匹配导致的内部错误，不影响项目代码。我们将不依赖该工具继续实现功能。

## 依赖安装
- 运行：`npm i express cors dotenv axios @volcengine/openapi`
- 可选（本地启动方便）：`npm i -D nodemon`
- 环境变量：在项目根目录创建 `.env.local`，配置 `VOLC_ACCESSKEY` 与 `VOLC_SECRETKEY`

## 后端：`server/index.js`（本地代理，提交→轮询→返回）
- 技术栈：Node + Express（单文件即可）
- 新增接口：`POST /api/generate`
  - 入参：`{ prompt: string, imageUrl?: string, scale?: number }`
  - 流程：
    1) 通过 `@volcengine/openapi` 的 `Signer` 按“cv / cn-north-1 / visual.volcengineapi.com”签名，调用 `Action=CVSync2AsyncSubmitTask`、`Version=2022-08-31`，Body：
       ```json
       { "req_key":"jimeng_t2i_v40", "prompt":"...", "image_urls":["..."], "scale":0.5, "logo_info":{ "add_logo": false } }
       ```
       若 `imageUrl` 缺失则使用一张演示用公网图片；若传入为 DataURI 则直接尝试（若 API 报错再降级成演示图）。
    2) 解析 `data.task_id`，进入轮询：每 1–2 秒调用 `Action=CVSync2AsyncGetResult`，Body：`{ "req_key":"jimeng_t2i_v40", "task_id":"..." }`
    3) 直到返回 `status=done` 或超时（60 秒）。成功返回 `{ imageUrls }`；失败返回 4xx/5xx 与中文错误文案。
  - 超时与重试：整体 60 秒超时；网络错误可退避重试 1 次。
  - 安全：AK/SK 从环境变量读取；不打印密钥；允许 CORS 仅本地开发。

## 前端改动（极简）
- 在 `src/services/imageProcessor.ts` 增加一个客户端函数用于调用本地接口：
  - `export async function generateByServer(prompt: string, imageUrl: string, scale = 0.5): Promise<string>`
  - 内部：`fetch('/api/generate', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({prompt, imageUrl, scale}) })`
  - 返回：最终图片 URL（或 base64 DataURL），供现有页面直接展示与下载
- 其余压缩/下载函数保持不变；后续可在 `useGeneration.ts` 中将 `mockAIService` 切换为真实接口（此次按你的要求先从 `imageProcessor.ts` 打通调用）。

## 开发与运行
- 后端：`node server/index.js`（或 `nodemon server/index.js`）
- 前端：`npm run dev`，前端直接调用 `/api/generate`
- 若需要本地代理配置，可在 `vite.config.ts` 加一个 devServer proxy 将 `/api` 指向 `http://127.0.0.1:8787`

## 交付顺序
1. 编写 `server/index.js` 签名与请求封装，打通“提交 → 轮询 → 返回”
2. 在 `imageProcessor.ts` 增加 `generateByServer` 并在结果页调用演示
3. 快速自测：用演示图片跑通；再尝试 DataURI，若不支持则后续补图片上传方案

## 参考
- SDK 使用与签名示例来源：`@volcengine/openapi` 官方文档与仓库（npm 与 GitHub）